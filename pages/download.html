<download>
    <script execute="beforeRender">
        let deferredPrompt;


        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            window.deferredPrompt = deferredPrompt;

            // Optionally, send analytics event that PWA install promo was shown.
            console.log(`'beforeinstallprompt' event was fired.`);
        });



    </script>

    <div  >
        <div class="hero mx-auto w-screen flex justify-center">
            <div class="hero-content text-start ">
                <div class="">
                    <h1 class="text-5xl font-bold ">Get Postr For Any Device!</h1>
                    <p class="py-6  ">
                        Keep posting where-ever you go with our mobile & desktop app.
                    </p>
                    <p class=" mb-2">
                        Your platform is detected as:   <span class="font-bold text-sky-500 "> ${{
                        let plat = navigator.userAgent.toLowerCase()
                        if(plat.includes('iphone') || plat.includes('ipad') || plat.includes('ipod') ){
                           let version = navigator.userAgent.match(/OS\s([0-9\_]*)/)[1].replace('_', '.')
                            version = version.replaceAll('_', '.')
                            if(version.split('.')[0] >= 13){
                                'IOS ' + 'v' + version
                            }
                            else{
                                'IOS (Old)'
                            }
                        }
                        else if(plat.includes('android')){
                          let version = navigator.userAgent.match(/Android\s([0-9\.]*)/)[1]
                            if(version >= 10){
                                'Android ' + 'v' +  version
                            }
                            else{
                                'Android (Old)'
                            }
                        }else if(plat.includes('mac')){
                            let version = navigator.userAgent.match(/Mac\s([0-9\.]*)/)[1]
                            if(version >= 10){
                                'Mac ' + 'v' + version
                            }
                            else{
                                'Mac (Old)'
                            }
                        }else if(plat.includes('ipad') || plat.includes('ipod')){
                            'iPadOS'
                        }
                        else if(plat.includes('win')){
                             let x = navigator.userAgent.match(/Windows\sNT\s([0-9\.]*)/)[1]
                             x = x.split('.')[0]
                            if(x >= 10){
                                'Windows ' +  x
                            }
                            else{
                                'Windows (Old)'
                            }

                        }
                        else if(plat.includes('linux')){
                            let arch = navigator.userAgent.match(/Linux\s([a-zA-Z0-9\_]*)/)[1]
                             'Linux ' + arch.charAt(0).toUpperCase() + arch.slice(1)
                        }
                         
                        }}


                    </p>

                    <button class="btn hover:bg-none flex w-full" onclick="
                let plat = navigator.userAgent.toLowerCase()
                console.log(plat)
                if(plat.includes('iphone') || plat.includes('ipad') || plat.includes('ipod')  || plat.includes('mac')){
                    document.getElementById('iosmodal').showModal()
                }
                
                else{
                    deferredPrompt.prompt()
                }

                if(window.matchMedia('(display-mode: standalone)').matches){
                    window.location.href = '#/'
                }
                ">
                        ${{
                        let platform = navigator.userAgent.toLowerCase()


                        if(platform.includes('android')){
                        `
                        <img src="https://img.icons8.com/?size=512&id=P2AnGyiJxMpp&format=png" class="w-6 h-6" />
                        Install on Android
                        `
                        }
                        else if(platform.includes('iphone')){
                        `
                        <img src="https://img.icons8.com/?size=512&id=95294&format=png" class="w-6 h-6" />
                        Install on iOS
                        `
                        }
                        else if(platform.includes('mac')){
                        `
                        <img src="https://img.icons8.com/?size=512&id=122959&format=png" class="w-6 h-6" />
                        Install on Mac
                        `
                        }else if (platform.includes('ipad') || platform.includes('ipod')){
                        'Download for Linux'
                        }
                        else if(platform.includes('win')){
                        `
                        <img src="https://img.icons8.com/?size=512&id=gXoJoyTtYXFg&format=png" class="w-6 h-6" />
                        Install on Windows
                        `
                        }
                        else if(platform.includes('linux')){
                        `
                        <img src="https://img.icons8.com/?size=512&id=17842&format=png" class="w-6 h-6" />
                        Install on Linux
                        `
                        }


                        }}
                    </button>
                    <div class="divider">
                        <span class="divider-text">or</span>
                    </div>
                    <center class="items-start">
                        <p class="py-6  ">
                            Scan the QR code to download the app.
                        </p>

                        <img src="/public/assets/images/download_qr.png" class="w-40">
                    </center>



                </div>
            </div>
        </div>
    </div>
    </div>
    <dialog id="iosmodal" class="modal">
        <form method="dialog" class="modal-box">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
            <h3 class="font-bold text-lg flex inline gap-5">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25" />
                </svg>

                Install Postr on iOS
            </h3>
            <div class="divider"></div>
            <p class="text-sm">To install Postr on iOS, follow these steps:</p>
            <div class="mt-5 gap-8 flex-col">
                <p class="flex inline gap-2">1. Tap <img src="./public/assets/images/ioshareicon.png" width="20"
                        height="20" /></p>

                <p> </p>
                <p>2. Tap "Add to Home Screen"</p>
                <P>
                    3. Horray ðŸŽ‰! You can now use Postr as an app on your iOS device!
                </P>
            </div>
        </form>
    </dialog>
</download>
